!function(e){"use strict";var a=e("#submit_jobs_form"),n=a.data("titleerror"),t=a.data("deserror"),o=a.data("caterror"),i=a.data("typeerror"),s=a.data("skillserror"),l=civi_submit_vars.ajax_url,c=civi_submit_vars.jobs_dashboard,d=civi_submit_vars.custom_field_jobs;e(document).ready(function(){e.validator.setDefaults({ignore:":hidden:not(select)"}),e.validator.addMethod("isCityName",function(a,n){var t=!1;if(""==a)return t=!0;var o="https://secure.geonames.org/searchJSON?q="+encodeURIComponent(a)+"&maxRows=1&username=ductrung";return e.ajax({url:o,method:"GET",dataType:"json",async:!1,success:function(e){e.geonames&&e.geonames.length>0&&-1!=e.geonames[0].fclName.indexOf("city")&&(t=!0)},error:function(){console.log("An error occurred while checking the city name.")}}),t}),e("#create_company_btn").click(function(){e("#new_company_job_form").removeClass("d-none"),e("#select_company_div").addClass("d-none"),e("#select_existing_company_btn").removeClass("d-none")}),e("#select_existing_company_btn").click(function(){e("#new_company_job_form").addClass("d-none"),e("#select_company_div").removeClass("d-none"),e("#select_existing_company_btn").addClass("d-none")}),a.validate({ignore:[],rules:{jobs_title:{required:!0},jobs_categories:{required:!0},jobs_type:{required:!0},jobs_skills:{required:!0},jobs_des:{required:!0},jobs_new_location:{isCityName:!1}},messages:{jobs_title:n,jobs_des:t,jobs_categories:o,jobs_type:i,jobs_skills:s,jobs_new_location:{isCityName:"Please enter a valid city name."}},submitHandler:function(n){var t,o,i,s,r,m,b,u,p,f,j,y,v,g,h,x,C,$,w,k,q,O,T,S,I,N,_,P,D,H,z,A,J,B,E,G,M,R,F,K,L,Q,U,V,W,X,Y,Z;t=e(this.submitButton).attr("name"),o=a.find('input[name="jobs_form"]').val(),i=a.find('input[name="jobs_action"]').val(),s=a.find('input[name="jobs_id"]').val(),r=a.find('input[name="jobs_title"]').val(),m=a.find('select[name="jobs_categories"]').val(),b=a.find('select[name="jobs_type"]').val(),u=a.find('select[name="jobs_skills"]').val(),p=tinymce.get("jobs_des").getContent(),f=a.find('select[name="jobs_career"]').val(),j=a.find('select[name="jobs_experience"]').val(),y=a.find('select[name="jobs_qualification"]').val(),v=a.find('select[name="jobs_quantity"]').val(),g=a.find('select[name="jobs_gender"]').val(),h=a.find('input[name="jobs_days_closing"]').val(),x=a.find('select[name="jobs_salary_show"]').val(),C=a.find('select[name="jobs_currency_type"]').val(),$=a.find('input[name="jobs_salary_minimum"]').val(),w=a.find('input[name="jobs_salary_maximum"]').val(),k=a.find('select[name="jobs_salary_rate"]').val(),q=a.find('input[name="jobs_minimum_price"]').val(),O=a.find('input[name="jobs_maximum_price"]').val(),T=a.find('select[name="jobs_select_apply"]').val(),S=a.find('input[name="jobs_apply_email"]').val(),I=a.find('input[name="jobs_apply_external"]').val(),N=a.find('input[name="jobs_apply_call_to"]').val(),_=a.find('select[name="jobs_select_company"]').val(),P=a.find('select[name="jobs_location"]').val(),D=a.find('input[name="jobs_new_location"]').val(),H=a.find('input[name="jobs_thumbnail_url"]').val(),z=a.find('input[name="jobs_thumbnail_id"]').val(),A=a.find('input[name="civi_gallery_ids[]"]').map(function(){return e(this).val()}).get(),J=a.find('input[name="jobs_video_url"]').val(),B=a.find('input[name="civi_map_address"]').val(),E=a.find('input[name="civi_map_location"]').val(),G=a.find('input[name="civi_latitude"]').val(),M=a.find('input[name="civi_longtitude"]').val(),R=a.find('input[name="company_title"]').val(),F=a.find('select[name="company_categories"]').val(),K=tinymce.get("company_des").getContent(),L=a.find('input[name="company_website"]').val(),Q=a.find('input[name="company_phone"]').val(),U=a.find('select[name="company_founded"]').val(),V=a.find('select[name="company_size"]').val(),W=a.find('select[name="company_location"]').val(),X=a.find('input[name="company_avatar_url"]').val(),Y=a.find('input[name="company_avatar_id"]').val(),Z={},e("#jobs-submit-additional").each(function(){e.each(d,function(a,n){var t=e(".form-control[name="+n.id+"]").val();if("radio"==n.type&&(t=e("input[name="+n.id+"]:checked").val()),"checkbox_list"==n.type){var o=[];e('input[name="'+n.id+'[]"]:checked').each(function(){o.push(e(this).val())}),t=o}"image"==n.type&&(t=e("input#custom_image_id_"+n.id).val()),Z[n.id]=t})}),e("#select_company_div").hasClass("d-none")?e.ajax({dataType:"json",url:l,data:{action:"company_submit_ajax",company_form:"submit-company",company_action:"add_company",company_title:R,company_categories:F,company_des:K,company_website:L,company_founded:U,company_phone:Q,company_size:V,company_location:W,company_avatar_url:X,company_avatar_id:Y},beforeSend:function(){e(".btn-submit-company .btn-loading").fadeIn()},success:function(a){console.log("Company created"),e.ajax({type:"POST",dataType:"json",url:l,data:{action:"jobs_submit_ajax",jobs_form:o,jobs_action:i,jobs_id:s,jobs_title:r,jobs_categories:m,jobs_type:b,jobs_skills:u,jobs_des:p,jobs_career:f,jobs_experience:j,jobs_qualification:y,jobs_quantity:v,jobs_gender:g,jobs_days_closing:h,jobs_salary_show:x,jobs_currency_type:C,jobs_salary_minimum:$,jobs_salary_maximum:w,jobs_salary_rate:k,jobs_minimum_price:q,jobs_maximum_price:O,jobs_select_apply:T,jobs_apply_email:S,jobs_apply_external:I,jobs_apply_call_to:N,jobs_select_company:a.company_id,jobs_location:P,jobs_new_location:D,jobs_thumbnail_url:H,jobs_thumbnail_id:z,civi_gallery_ids:A,jobs_video_url:J,custom_field_jobs:Z,jobs_map_address:B,jobs_map_location:E,jobs_latitude:G,jobs_longtitude:M,submit_button:t},beforeSend:function(){"submit_jobs"==t?e(".btn-submit-jobs .btn-loading").fadeIn():e(".btn-submit-draft .btn-loading").fadeIn()},success:function(a){"submit_jobs"==t?(e(".btn-submit-jobs .btn-loading").fadeOut(),console.log("job created"),!0===a.success&&(window.location.href=c)):e(".btn-submit-draft .btn-loading").fadeOut()}})}}):e.ajax({type:"POST",dataType:"json",url:l,data:{action:"jobs_submit_ajax",jobs_form:o,jobs_action:i,jobs_id:s,jobs_title:r,jobs_categories:m,jobs_type:b,jobs_skills:u,jobs_des:p,jobs_career:f,jobs_experience:j,jobs_qualification:y,jobs_quantity:v,jobs_gender:g,jobs_days_closing:h,jobs_salary_show:x,jobs_currency_type:C,jobs_salary_minimum:$,jobs_salary_maximum:w,jobs_salary_rate:k,jobs_minimum_price:q,jobs_maximum_price:O,jobs_select_apply:T,jobs_apply_email:S,jobs_apply_external:I,jobs_apply_call_to:N,jobs_select_company:_,jobs_location:P,jobs_new_location:D,jobs_thumbnail_url:H,jobs_thumbnail_id:z,civi_gallery_ids:A,jobs_video_url:J,custom_field_jobs:Z,jobs_map_address:B,jobs_map_location:E,jobs_latitude:G,jobs_longtitude:M,submit_button:t},beforeSend:function(){"submit_jobs"==t?e(".btn-submit-jobs .btn-loading").fadeIn():e(".btn-submit-draft .btn-loading").fadeIn()},success:function(a){"submit_jobs"==t?(e(".btn-submit-jobs .btn-loading").fadeOut(),!0===a.success&&(window.location.href=c)):e(".btn-submit-draft .btn-loading").fadeOut()}})},errorPlacement:function(e,a){e.insertAfter(a)},invalidHandler:function(){e(".error:visible").length>0&&e("html, body").animate({scrollTop:e(".error:visible").offset().top-100},500)}}),e(".ai-helper").on("click",function(a){a.preventDefault();var n=e(this).attr("data-popup");e("#"+n).addClass("open")}),e(window).width()>767&&e(".generate-content").each(function(){var a=e(this).find(".left"),n=e(this).find(".right"),t=a.outerHeight();n.css("height",t)}),e(".ai-generate").on("submit",function(a){a.preventDefault();var n=e(this),t=e(this).closest(".ai-popup"),o=t.find(".inner-popup"),i=n.find('textarea[name="ai_prompt"]').val(),s=n.find('select[name="ai_tone"] option:selected').text(),c=n.find('select[name="ai_language"] option:selected').text();e.ajax({url:l,type:"POST",data:{action:"auto_description_generate",keywords:i,tone:s,language:c},beforeSend:function(){n.find(".btn-loading").fadeIn(),t.find(".suggestion").text(""),n.find(".field-notice").removeClass("error"),n.find(".field-notice p").text(""),t.find(".generate-content").removeClass("has-suggestion")},success:function(a){var a=e.parseJSON(a);n.find(".btn-loading").fadeOut(),a.success?(n.find(".field-submit button .text").text(civi_submit_vars.regenerate),t.find(".generate-content").addClass("has-suggestion"),t.find(".suggestion").html(a.message),768>e(window).width()&&e(".ai-popup .inner-popup").animate({scrollTop:t.find(".suggestion").offset().top-o.offset().top-40},500),e(".keep-generate").on("click",function(o){o.preventDefault(),tinymce.get("jobs_des").setContent(a.message),t.find(".generate-content").removeClass("has-suggestion"),e(".ai-generate")[0].reset(),n.closest(".popup").removeClass("open"),n.find(".field-submit button .text").text(civi_submit_vars.generate)})):(n.find(".field-notice p").text(a.message),n.find(".field-notice").addClass("error"))}})})})}(jQuery);