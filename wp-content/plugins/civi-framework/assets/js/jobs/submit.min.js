(function(B){"use strict";var E=B("#submit_jobs_form"),e=E.data("titleerror"),t=E.data("deserror"),n=E.data("caterror"),a=E.data("typeerror"),s=E.data("skillserror");var G=civi_submit_vars.ajax_url,M=civi_submit_vars.jobs_dashboard,Q=civi_submit_vars.custom_field_jobs;B(document).ready(function(){B.validator.setDefaults({ignore:":hidden:not(select)"});B.validator.addMethod("isCityName",function(e,t){var i="ductrung";var n=false;if(e==""){n=true;return n}else{var a="https://secure.geonames.org/searchJSON?q="+encodeURIComponent(e)+"&maxRows=1&username="+i;B.ajax({url:a,method:"GET",dataType:"json",async:false,success:function(e){if(e.geonames&&e.geonames.length>0){var t=e.geonames[0].fclName;if(t.indexOf("city")!=-1){n=true}}},error:function(){console.log("An error occurred while checking the city name.")}});return n}});E.validate({ignore:[],rules:{jobs_title:{required:true},jobs_categories:{required:true},jobs_type:{required:true},jobs_skills:{required:true},jobs_des:{required:true},jobs_new_location:{isCityName:true}},messages:{jobs_title:e,jobs_des:t,jobs_categories:n,jobs_type:a,jobs_skills:s,jobs_new_location:{isCityName:"Please enter a valid city name."}},submitHandler:function(e){var t=B(this.submitButton).attr("name");i(t)},errorPlacement:function(e,t){e.insertAfter(t)},invalidHandler:function(){if(B(".error:visible").length>0){B("html, body").animate({scrollTop:B(".error:visible").offset().top-100},500)}}});function i(t){var e=E.find('input[name="jobs_form"]').val(),i=E.find('input[name="jobs_action"]').val(),n=E.find('input[name="jobs_id"]').val(),a=E.find('input[name="jobs_title"]').val(),s=E.find('select[name="jobs_categories"]').val(),o=E.find('select[name="jobs_type"]').val(),l=E.find('select[name="jobs_skills"]').val(),r=tinymce.get("jobs_des").getContent(),d=E.find('select[name="jobs_career"]').val(),_=E.find('select[name="jobs_experience"]').val(),u=E.find('select[name="jobs_qualification"]').val(),c=E.find('select[name="jobs_quantity"]').val(),m=E.find('select[name="jobs_gender"]').val(),b=E.find('input[name="jobs_days_closing"]').val(),f=E.find('select[name="jobs_salary_show"]').val(),p=E.find('select[name="jobs_currency_type"]').val(),j=E.find('input[name="jobs_salary_minimum"]').val(),v=E.find('input[name="jobs_salary_maximum"]').val(),g=E.find('select[name="jobs_salary_rate"]').val(),y=E.find('input[name="jobs_minimum_price"]').val(),h=E.find('input[name="jobs_maximum_price"]').val(),x=E.find('select[name="jobs_select_apply"]').val(),w=E.find('input[name="jobs_apply_email"]').val(),k=E.find('input[name="jobs_apply_external"]').val(),C=E.find('input[name="jobs_apply_call_to"]').val(),q=E.find('select[name="jobs_select_company"]').val(),O=E.find('select[name="jobs_location"]').val(),T=E.find('input[name="jobs_new_location"]').val(),N=E.find('input[name="jobs_thumbnail_url"]').val(),S=E.find('input[name="jobs_thumbnail_id"]').val(),D=E.find('input[name="civi_gallery_ids[]"]').map(function(){return B(this).val()}).get(),I=E.find('input[name="jobs_video_url"]').val(),P=E.find('input[name="civi_map_address"]').val(),H=E.find('input[name="civi_map_location"]').val(),J=E.find('input[name="civi_latitude"]').val(),R=E.find('input[name="civi_longtitude"]').val();var A={};B("#jobs-submit-additional").each(function(){B.each(Q,function(e,t){var i=B(".form-control[name="+t.id+"]").val();if(t.type=="radio"){i=B("input[name="+t.id+"]:checked").val()}if(t.type=="checkbox_list"){var n=[];B('input[name="'+t.id+'[]"]:checked').each(function(){n.push(B(this).val())});i=n}if(t.type=="image"){i=B("input#custom_image_id_"+t.id).val()}A[t.id]=i})});B.ajax({type:"POST",dataType:"json",url:G,data:{action:"jobs_submit_ajax",jobs_form:e,jobs_action:i,jobs_id:n,jobs_title:a,jobs_categories:s,jobs_type:o,jobs_skills:l,jobs_des:r,jobs_career:d,jobs_experience:_,jobs_qualification:u,jobs_quantity:c,jobs_gender:m,jobs_days_closing:b,jobs_salary_show:f,jobs_currency_type:p,jobs_salary_minimum:j,jobs_salary_maximum:v,jobs_salary_rate:g,jobs_minimum_price:y,jobs_maximum_price:h,jobs_select_apply:x,jobs_apply_email:w,jobs_apply_external:k,jobs_apply_call_to:C,jobs_select_company:q,jobs_location:O,jobs_new_location:T,jobs_thumbnail_url:N,jobs_thumbnail_id:S,civi_gallery_ids:D,jobs_video_url:I,custom_field_jobs:A,jobs_map_address:P,jobs_map_location:H,jobs_latitude:J,jobs_longtitude:R,submit_button:t},beforeSend:function(){if(t=="submit_jobs"){B(".btn-submit-jobs .btn-loading").fadeIn()}else{B(".btn-submit-draft .btn-loading").fadeIn()}},success:function(e){if(t=="submit_jobs"){B(".btn-submit-jobs .btn-loading").fadeOut();if(e.success===true){window.location.href=M}}else{B(".btn-submit-draft .btn-loading").fadeOut()}}})}B(".ai-helper").on("click",function(e){e.preventDefault();var t=B(this),i=t.attr("data-popup");B("#"+i).addClass("open")});if(B(window).width()>767){B(".generate-content").each(function(){var e=B(this).find(".left"),t=B(this).find(".right"),i=e.outerHeight();t.css("height",i)})}B(".ai-generate").on("submit",function(e){e.preventDefault();var i=B(this),n=B(this).closest(".ai-popup"),a=n.find(".inner-popup"),t=i.find('textarea[name="ai_prompt"]').val(),s=i.find('select[name="ai_tone"] option:selected').text(),o=i.find('select[name="ai_language"] option:selected').text();B.ajax({url:G,type:"POST",data:{action:"auto_description_generate",keywords:t,tone:s,language:o},beforeSend:function(){i.find(".btn-loading").fadeIn();n.find(".suggestion").text("");i.find(".field-notice").removeClass("error");i.find(".field-notice p").text("");n.find(".generate-content").removeClass("has-suggestion")},success:function(t){var t=B.parseJSON(t);i.find(".btn-loading").fadeOut();if(t.success){i.find(".field-submit button .text").text(civi_submit_vars.regenerate);n.find(".generate-content").addClass("has-suggestion");n.find(".suggestion").html(t.message);if(B(window).width()<768){B(".ai-popup .inner-popup").animate({scrollTop:n.find(".suggestion").offset().top-a.offset().top-40},500)}B(".keep-generate").on("click",function(e){e.preventDefault();tinymce.get("jobs_des").setContent(t.message);n.find(".generate-content").removeClass("has-suggestion");B(".ai-generate")[0].reset();i.closest(".popup").removeClass("open");i.find(".field-submit button .text").text(civi_submit_vars.generate)})}else{i.find(".field-notice p").text(t.message);i.find(".field-notice").addClass("error")}}})})})})(jQuery);